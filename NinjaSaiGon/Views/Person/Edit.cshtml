@model Person

@{
    ViewData["Title"] = "Edit";
    var cultureInfo = new CultureInfo("vi-VN");
    cultureInfo.NumberFormat.NumberDecimalSeparator = ".";
    CultureInfo.DefaultThreadCurrentCulture = cultureInfo;
    CultureInfo.DefaultThreadCurrentUICulture = cultureInfo;
    var strPersonType = Model.PersonType == PersonType.Customer ? "khách hàng" : Model.PersonType == PersonType.Employee ? "nhân viên" : "người đại diện";
    IEnumerable<DistrictPlace> allDistricts = ViewBag.DistrictPlaces;
    IEnumerable<Ward> allWards = ViewBag.Wards;
}

<div class="m-grid__item m-grid__item--fluid m-wrapper">
    <div class="m-content">
        <div class="m-portlet m-portlet--mobile">
            <div class="m-portlet__head">
                <div class="m-portlet__head-caption">
                    <div class="m-portlet__head-title">
                        <h3 class="m-portlet__head-text">
                            Sửa @strPersonType
                        </h3>
                    </div>
                </div>
            </div>
            <div class="m-portlet__body">
                <form asp-action="Edit" asp-route-type="@Model.PersonType" class="m-form m-form--label-align-right" id="editPersonForm">
                    <div asp-validation-summary="ModelOnly" class="text-danger"></div>
                    <input asp-for="Code" type="hidden" />
                    <input asp-for="PersonType" type="hidden" />
                    <div class="m-portlet__body">
                        @if (Model.PersonType == PersonType.Customer)
                        {
                            <div class="m-portlet m-portlet--tab">
                                <div class="m-portlet__head">
                                    <div class="m-portlet__head-caption">
                                        <div class="m-portlet__head-title">
                                            <span class="m-portlet__head-icon m--hide">
                                                <i class="la la-gear"></i>
                                            </span>
                                            <h3 class="m-portlet__head-text">
                                                Phân loại khách hàng
                                            </h3>
                                        </div>
                                    </div>
                                </div>
                                <div class="m-portlet__body">
                                    <div class="form-group m-form__group row">
                                        <label class="col-lg-2 col-form-label">
                                            Loại khách hàng
                                        </label>
                                        <div class="col-lg-4">
                                            <select asp-for="PersonLevelId" asp-items="@(new SelectList(ViewBag.PersonLevels, "Id", "Name"))" class="form-control m-input m-input--square"></select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="m-portlet m-portlet--tab">
                                <div class="m-portlet__head">
                                    <div class="m-portlet__head-caption">
                                        <div class="m-portlet__head-title">
                                            <span class="m-portlet__head-icon m--hide">
                                                <i class="la la-gear"></i>
                                            </span>
                                            <h3 class="m-portlet__head-text">
                                                Nguồn khách hàng
                                            </h3>
                                        </div>
                                    </div>
                                </div>
                                <div class="m-portlet__body">
                                    <div class="form-group m-form__group row">
                                        <label class="col-lg-2 col-form-label">
                                            Nguồn khách hàng
                                        </label>
                                        <div class="col-lg-10">
                                            <div class="form-group m-form__group row">
                                                <div class="col-lg-4">
                                                    <select asp-for="PersonCustomerSourceTypeId" asp-items="@(new SelectList(ViewBag.PersonCustomerSourceTypes, "Id", "Value"))" class="form-control m-input m-input--square"></select>
                                                </div>
                                                <div class="col-lg-4 cussrc-display-name-container" style="display: @(Model.PersonCustomerSourceTypeId == 1  || Model.PersonCustomerSourceTypeId == 2 || Model.PersonCustomerSourceTypeId == 3 || Model.PersonCustomerSourceTypeId == 5 ? "block" : "none")">
                                                    <input id="CustomerSourceName" class="form-control m-input" 
                                                           value="@(Model.PersonCustomerSourceTypeId == 1 ? Model.CustomerSourceEmp?.PrimaryName : Model.PersonCustomerSourceTypeId == 2 ? Model.Agency?.Name : Model.PersonCustomerSourceTypeId == 3 ? Model.CustomerSourceCus?.PrimaryName : "")" 
                                                           required readonly 
                                                           style="display: @(Model.PersonCustomerSourceTypeId == 1 || Model.PersonCustomerSourceTypeId == 2 || Model.PersonCustomerSourceTypeId == 3 ? "block" : "none")" />
                                                    <input asp-for="CustomerSourceEmpId" type="hidden" />
                                                    <input asp-for="AgencyId" type="hidden" />
                                                    <input asp-for="CustomerSourceCusId" type="hidden" />

                                                    <select asp-for="SocialTypeId" asp-items="@(new SelectList(ViewBag.SocialTypes, "Id", "Value", Model.SocialTypeId.HasValue ? Model.SocialTypeId.Value.ToString() : ""))" style="display: @(Model.PersonCustomerSourceTypeId == 5 ? "block" : "none")" class="form-control m-input m-input--square">
                                                        <option value="">Chọn</option>
                                                    </select>
                                                </div>
                                                <div class="col-lg-4">
                                                    <button type="button" class="btn btn-info btn-sm" id="btn-chooseCustomerSource" style="display: @(Model.PersonCustomerSourceTypeId == 1  || Model.PersonCustomerSourceTypeId == 2 || Model.PersonCustomerSourceTypeId == 3 ? "block" : "none")">Chọn nguồn khách hàng</button>
                                                </div>
                                                <div class="col-lg-10 mt-2">
                                                    <input asp-for="CustomerSourceNote" class="form-control m-input" placeholder="Ghi chú" autocomplete="off" />
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        }
                        <div class="m-portlet m-portlet--tab">
                            <div class="m-portlet__head">
                                <div class="m-portlet__head-caption">
                                    <div class="m-portlet__head-title">
                                        <span class="m-portlet__head-icon m--hide">
                                            <i class="la la-gear"></i>
                                        </span>
                                        <h3 class="m-portlet__head-text">
                                            Thông tin cá nhân
                                        </h3>
                                    </div>
                                </div>
                            </div>
                            <div class="m-portlet__body">
                                <div class="form-group m-form__group row">
                                    <div class="col-md-7">
                                        <div class="form-group m-form__group row">
                                            <label class="col-lg-2 col-form-label">
                                                Danh xưng
                                            </label>
                                            <div class="col-lg-4">
                                                <select asp-for="TitlePrefixType" asp-items="Html.GetEnumSelectList<TitlePrefix>()" class="form-control m-input m-input--square"></select>
                                                <span asp-validation-for="TitlePrefixType" class="form-control-feedback"></span>
                                            </div>
                                        </div>
                                        <div class="form-group m-form__group row">
                                            <label class="col-lg-2 col-form-label">
                                                Tên @strPersonType
                                            </label>
                                            <div class="col-lg-3">
                                                <input name="Names[0].LastName" class="form-control m-input" placeholder="Họ" autocomplete="off" value="@Model.Names.ElementAt(0).LastName" />
                                            </div>
                                            <div class="col-lg-3">
                                                <input name="Names[0].MidName" class="form-control m-input" placeholder="Đệm" autocomplete="off" value="@Model.Names.ElementAt(0).MidName" />
                                            </div>
                                            <div class="col-lg-3">
                                                <input name="Names[0].FirstName" class="form-control m-input" placeholder="Tên" autocomplete="off" value="@Model.Names.ElementAt(0).FirstName" required />
                                            </div>
                                            <input type="hidden" name="Names[0].Id" value="@Model.Names.ElementAt(0).Id" />
                                            <input type="hidden" name="Names[0].TypeId" value="1" />
                                        </div>
                                        <div class="form-group m-form__group row">
                                            <label class="col-lg-2 col-form-label">
                                                Ngày sinh
                                            </label>
                                            <div class="col-lg-4">
                                                <input id="dob-picker" class="form-control m-input datepicker" autocomplete="off" value="@Model.PrimaryDOB" />
                                                <input type="hidden" id="dob-day" name="DOBs[0].Day" value="@Model.DOBs.ElementAt(0).Day" />
                                                <input type="hidden" id="dob-month" name="DOBs[0].Month" value="@Model.DOBs.ElementAt(0).Month" />
                                                <input type="hidden" id="dob-year" name="DOBs[0].Year" value="@Model.DOBs.ElementAt(0).Year" />
                                                <input type="hidden" name="DOBs[0].TypeId" value="1" />
                                            </div>
                                        </div>
                                        <div id="nationalities-container">
                                            @for (var i = 0; i < Model.Nationalities.Count; i++)
                                            {
                                                var nation = Model.Nationalities.ElementAt(i);
                                                <div class="form-group m-form__group row nationality-item" data-index="@i">
                                                    <label class="col-lg-2 col-form-label">Quốc tịch</label>
                                                    <div class="col-lg-4">
                                                        <input type="hidden" name="Nationalities[@i].PersonId" value="@nation.PersonId" />
                                                        <select name="Nationalities[@i].NationalityId" asp-items="@(new SelectList(ViewBag.Nationalities, "Id", "Value", nation.NationalityId))" class="form-control m-input m-input--square"></select>
                                                    </div>
                                                    <div class="col-lg-4">
                                                        <input type="hidden" class="IsDeletedNationality" name="Nationalities[@i].IsDeleted" value="false">
                                                        @if (i == 0)
                                                        {
                                                            <button type="button" class="btn btn-secondary btn-sm" id="add-nationality" data-index="@Model.Nationalities.Count">Thêm Quốc tịch</button>
                                                        }
                                                        else
                                                        {
                                                            <a class="m-portlet__nav-link btn m-btn m-btn--hover-danger m-btn--icon m-btn--icon-only m-btn--pill btn-deleteNationality" data-index="@i">
                                                                <i class="la la-trash"></i>
                                                            </a>
                                                        }
                                                    </div>
                                                </div>
                                            }
                                            <div hidden id="addNationalityTemplate">
                                                <div class="form-group m-form__group row nationality-item" data-index="{pIndex}">
                                                    <label class="col-lg-2 col-form-label">&nbsp;</label>
                                                    <div class="col-lg-4">
                                                        <select name="Nationalities[{pIndex}].NationalityId" asp-items="@(new SelectList(ViewBag.Nationalities, "Id", "Value"))" class="form-control m-input m-input--square"></select>
                                                    </div>
                                                    <div class="col-lg-4">
                                                        <input type="hidden" class="IsDeletedNationality" name="Nationalities[{pIndex}].IsDeleted" value="false">
                                                        <a class="m-portlet__nav-link btn m-btn m-btn--hover-danger m-btn--icon m-btn--icon-only m-btn--pill btn-deleteNationality" data-index="{pIndex}">
                                                            <i class="la la-trash"></i>
                                                        </a>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-5">
                                        <div class="form-group m-form__group row">
                                            <label class="col-lg-2 col-form-label">
                                                Nơi sinh
                                            </label>
                                            <div class="col-lg-10">
                                                <input type="hidden" name="HomeTown.PersonId" value="@Model.HomeTown.PersonId" />
                                                <input name="HomeTown.MoreInfo" class="form-control m-input" autocomplete="off" value="@Model.HomeTown.MoreInfo" />
                                            </div>
                                        </div>
                                        <div class="form-group m-form__group row">
                                            <label class="col-lg-2 col-form-label">
                                                Giới tính
                                            </label>
                                            <div class="col-lg-4">
                                                <select asp-for="GenderId" asp-items="Html.GetEnumSelectList<GenderType>()" class="form-control m-input m-input--square"></select>
                                                <span asp-validation-for="GenderId" class="form-control-feedback"></span>
                                            </div>
                                        </div>
                                        <div class="form-group m-form__group row">
                                            <label class="col-lg-2 col-form-label">
                                                Dân tộc
                                            </label>
                                            <div class="col-lg-4">
                                                <select asp-for="EthnicId" asp-items="@(new SelectList(ViewBag.Ethnics, "Id", "Value"))" class="form-control m-input m-input--square"></select>
                                                <span asp-validation-for="EthnicId" class="form-control-feedback"></span>
                                            </div>
                                        </div>
                                        <div class="form-group m-form__group row">
                                            <label class="col-lg-2 col-form-label">
                                                Tôn giáo
                                            </label>
                                            <div class="col-lg-4">
                                                <select asp-for="ReligionId" asp-items="@(new SelectList(ViewBag.Religions, "Id", "Value"))" class="form-control m-input m-input--square"></select>
                                                <span asp-validation-for="ReligionId" class="form-control-feedback"></span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="m-portlet m-portlet--tab">
                            <div class="m-portlet__head">
                                <div class="m-portlet__head-caption">
                                    <div class="m-portlet__head-title">
                                        <span class="m-portlet__head-icon m--hide">
                                            <i class="la la-gear"></i>
                                        </span>
                                        <h3 class="m-portlet__head-text">
                                            Thông tin giấy tờ tùy thân
                                        </h3>
                                    </div>
                                </div>
                            </div>
                            <div class="m-portlet__body">
                                <div id="passport-container">
                                    @for (var i = 0; i < Model.Passports.Count; i++)
                                    {
                                        var passport = Model.Passports.ElementAt(i);
                                        <div class="form-group m-form__group row passport-item @(i > 0 ? "pt-4" : "")" data-index="@i">
                                            <input type="hidden" name="Passports[@i].Id" value="@passport.Id">
                                            <input type="hidden" class="IsDeletedPassport" name="Passports[@i].IsDeleted" value="false">
                                            <div class="col-md-6">
                                                <div class="form-group m-form__group row">
                                                    <label class="col-lg-3 col-form-label">
                                                        Số Hộ chiếu
                                                    </label>
                                                    <div class="col-lg-4">
                                                        <input name="Passports[@i].IDNumber" class="form-control m-input" autocomplete="off" value="@passport.IDNumber" />
                                                    </div>
                                                </div>
                                                <div class="form-group m-form__group row">
                                                    <label class="col-lg-3 col-form-label">
                                                        Nơi cấp Hộ chiếu
                                                    </label>
                                                    <div class="col-lg-9">
                                                        <input name="Passports[@i].ProvidedPlace" class="form-control m-input" autocomplete="off" value="@passport.ProvidedPlace" />
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="form-group m-form__group row">
                                                    <label class="col-lg-3 col-form-label">
                                                        Ngày hết hạn Hộ chiếu
                                                    </label>
                                                    <div class="col-lg-4">
                                                        <input name="Passports[@i].ProvidedDate" class="form-control m-input datepicker" autocomplete="off" value="@passport.ProvidedDate" />
                                                    </div>
                                                </div>
                                                <div class="form-group m-form__group row">
                                                    <label class="col-lg-3 col-form-label">
                                                        Ngày cấp Hộ chiếu
                                                    </label>
                                                    <div class="col-lg-4">
                                                        <input name="Passports[@i].ExpriredDate" class="form-control m-input datepicker" autocomplete="off" value="@passport.ExpriredDate" />
                                                    </div>
                                                    @if (i > 0)
                                                    {
                                                        <div class="col-lg-4">
                                                            <a class="m-portlet__nav-link btn m-btn m-btn--hover-danger m-btn--icon m-btn--icon-only m-btn--pill btn-deletePassport" data-index="@i">
                                                                <i class="la la-trash"></i>
                                                            </a>
                                                        </div>
                                                    }
                                                </div>
                                            </div>
                                        </div>
                                    }
                                    <div hidden id="addPassportTemplate">
                                        <div class="form-group m-form__group row pt-4 passport-item" data-index="{pIndex}">
                                            <div class="col-md-6">
                                                <div class="form-group m-form__group row">
                                                    <label class="col-lg-3 col-form-label">
                                                        Số Hộ chiếu
                                                    </label>
                                                    <div class="col-lg-4">
                                                        <input name="Passports[{pIndex}].IDNumber" class="form-control m-input" autocomplete="off" />
                                                    </div>
                                                </div>
                                                <div class="form-group m-form__group row">
                                                    <label class="col-lg-3 col-form-label">
                                                        Nơi cấp Hộ chiếu
                                                    </label>
                                                    <div class="col-lg-9">
                                                        <input name="Passports[{pIndex}].ProvidedPlace" class="form-control m-input" autocomplete="off" />
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="form-group m-form__group row">
                                                    <label class="col-lg-3 col-form-label">
                                                        Ngày hết hạn Hộ chiếu
                                                    </label>
                                                    <div class="col-lg-4">
                                                        <input name="Passports[{pIndex}].ProvidedDate" class="form-control m-input datepicker" autocomplete="off" />
                                                    </div>
                                                </div>
                                                <div class="form-group m-form__group row">
                                                    <label class="col-lg-3 col-form-label">
                                                        Ngày cấp Hộ chiếu
                                                    </label>
                                                    <div class="col-lg-4">
                                                        <input name="Passports[{pIndex}].ExpriredDate" class="form-control m-input datepicker" autocomplete="off" />
                                                    </div>
                                                    <div class="col-lg-4">
                                                        <input type="hidden" class="IsDeletedPassport" name="Passports[{pIndex}].IsDeleted" value="false">
                                                        <a class="m-portlet__nav-link btn m-btn m-btn--hover-danger m-btn--icon m-btn--icon-only m-btn--pill btn-deletePassport" data-index="{pIndex}">
                                                            <i class="la la-trash"></i>
                                                        </a>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group m-form__group row pt-2">
                                    <div class="col-lg-12 text-right">
                                        <button type="button" class="btn btn-secondary btn-sm" id="add-passport" data-index="@Model.Passports.Count">Thêm Hộ chiếu</button>
                                    </div>
                                </div>

                                <div id="idcard-container">
                                    @for (var i = 0; i < Model.IDCards.Count; i++)
                                    {
                                        var idcard = Model.IDCards.ElementAt(i);
                                        <div class="form-group m-form__group row idcard-item @(i > 0 ? "pt-4" : "")" data-index="@i">
                                            <input type="hidden" name="IDCards[@i].Id" value="@idcard.Id">
                                            <input type="hidden" class="IsDeletedIDCard" name="IDCards[@i].IsDeleted" value="false">
                                            <div class="col-md-6">
                                                <div class="form-group m-form__group row">
                                                    <label class="col-lg-3 col-form-label">
                                                        Số CMND
                                                    </label>
                                                    <div class="col-lg-4">
                                                        <input name="IDCards[@i].IDNumber" class="form-control m-input" autocomplete="off" value="@idcard.IDNumber" />
                                                    </div>
                                                </div>
                                                <div class="form-group m-form__group row">
                                                    <label class="col-lg-3 col-form-label">
                                                        Nơi cấp CMND
                                                    </label>
                                                    <div class="col-lg-9">
                                                        <input name="IDCards[@i].ProvidedPlace" class="form-control m-input" autocomplete="off" value="@idcard.ProvidedPlace" />
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="form-group m-form__group row">
                                                    <label class="col-lg-3 col-form-label">
                                                        Ngày hết hạn Hộ chiếu
                                                    </label>
                                                    <div class="col-lg-4">
                                                        <input name="IDCards[@i].ProvidedDate" class="form-control m-input datepicker" autocomplete="off" value="@idcard.ProvidedDate" />
                                                    </div>
                                                </div>
                                                <div class="form-group m-form__group row">
                                                    <label class="col-lg-3 col-form-label">
                                                        Ngày cấp Hộ chiếu
                                                    </label>
                                                    <div class="col-lg-4">
                                                        <input name="IDCards[@i].ExpriredDate" class="form-control m-input datepicker" autocomplete="off" value="@idcard.ExpriredDate" />
                                                    </div>
                                                    @if (i > 0)
                                                    {
                                                        <div class="col-lg-4">
                                                            <a class="m-portlet__nav-link btn m-btn m-btn--hover-danger m-btn--icon m-btn--icon-only m-btn--pill btn-deleteIDCard" data-index="@i">
                                                                <i class="la la-trash"></i>
                                                            </a>
                                                        </div>
                                                    }
                                                </div>
                                            </div>
                                        </div>
                                    }
                                    <div hidden id="addIDCardTemplate">
                                        <div class="form-group m-form__group row pt-4 idcard-item" data-index="{pIndex}">
                                            <div class="col-md-6">
                                                <div class="form-group m-form__group row">
                                                    <label class="col-lg-3 col-form-label">
                                                        Số CMND
                                                    </label>
                                                    <div class="col-lg-4">
                                                        <input name="IDCards[{pIndex}].IDNumber" class="form-control m-input" autocomplete="off" />
                                                    </div>
                                                </div>
                                                <div class="form-group m-form__group row">
                                                    <label class="col-lg-3 col-form-label">
                                                        Nơi cấp CMND
                                                    </label>
                                                    <div class="col-lg-9">
                                                        <input name="IDCards[{pIndex}].ProvidedPlace" class="form-control m-input" autocomplete="off" />
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="form-group m-form__group row">
                                                    <label class="col-lg-3 col-form-label">
                                                        Ngày hết hạn CMND
                                                    </label>
                                                    <div class="col-lg-4">
                                                        <input name="IDCards[{pIndex}].ProvidedDate" class="form-control m-input datepicker" autocomplete="off" />
                                                    </div>
                                                </div>
                                                <div class="form-group m-form__group row">
                                                    <label class="col-lg-3 col-form-label">
                                                        Ngày cấp CMND
                                                    </label>
                                                    <div class="col-lg-4">
                                                        <input name="IDCards[{pIndex}].ExpriredDate" class="form-control m-input datepicker" autocomplete="off" />
                                                    </div>
                                                    <div class="col-lg-4">
                                                        <input type="hidden" class="IsDeletedIDCard" name="IDCards[{pIndex}].IsDeleted" value="false">
                                                        <a class="m-portlet__nav-link btn m-btn m-btn--hover-danger m-btn--icon m-btn--icon-only m-btn--pill btn-deleteIDCard" data-index="{pIndex}">
                                                            <i class="la la-trash"></i>
                                                        </a>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group m-form__group row pt-2">
                                    <div class="col-lg-12 text-right">
                                        <button type="button" class="btn btn-secondary btn-sm" id="add-idcard" data-index="@Model.IDCards.Count">Thêm CMND</button>
                                    </div>
                                </div>

                                <div id="iddocument-container">
                                    @for (var i = 0; i < Model.IDDocuments.Count; i++)
                                    {
                                        var iddocument = Model.IDDocuments.ElementAt(i);
                                        <div class="form-group m-form__group row iddocument-item @(i > 0 ? "pt-4" : "")" data-index="@i">
                                            <input type="hidden" name="IDDocuments[@i].Id" value="@iddocument.Id">
                                            <input type="hidden" class="IsDeletedIDDocument" name="IDDocuments[@i].IsDeleted" value="false">
                                            <div class="col-md-6">
                                                <div class="form-group m-form__group row">
                                                    <label class="col-lg-3 col-form-label">
                                                        Loại giấy tờ
                                                    </label>
                                                    <div class="col-lg-4">
                                                        <select name="IDDocuments[@i].IDDocumentTypeId" asp-items="@(new SelectList(ViewBag.IDDocumentTypes, "Id", "Value", iddocument.IDDocumentTypeId))" class="form-control m-input m-input--square iddocument-type" data-index="@i">
                                                            <option value="" selected>Chọn</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="form-group m-form__group row">
                                                    <label class="col-lg-3 col-form-label">
                                                        Số
                                                    </label>
                                                    <div class="col-lg-4">
                                                        <input name="IDDocuments[@i].IDNumber" class="form-control m-input" autocomplete="off" value="@iddocument.IDNumber" />
                                                    </div>
                                                </div>
                                                <div class="form-group m-form__group row">
                                                    <label class="col-lg-3 col-form-label">
                                                        Nơi cấp
                                                    </label>
                                                    <div class="col-lg-9">
                                                        <input name="IDDocuments[@i].ProvidedPlace" class="form-control m-input" autocomplete="off" value="@iddocument.ProvidedPlace" />
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="form-group m-form__group row">
                                                    <label class="col-lg-3 col-form-label">
                                                        Tên giấy tờ
                                                    </label>
                                                    <div class="col-lg-9">
                                                        <input data-index="@i" class="form-control m-input iddocument-name" autocomplete="off" readonly />
                                                    </div>
                                                </div>
                                                <div class="form-group m-form__group row">
                                                    <label class="col-lg-3 col-form-label">
                                                        Ngày hết hạn
                                                    </label>
                                                    <div class="col-lg-4">
                                                        <input name="IDDocuments[@i].ProvidedDate" class="form-control m-input datepicker" autocomplete="off" value="@iddocument.ProvidedDate" />
                                                    </div>
                                                </div>
                                                <div class="form-group m-form__group row">
                                                    <label class="col-lg-3 col-form-label">
                                                        Ngày cấp
                                                    </label>
                                                    <div class="col-lg-4">
                                                        <input name="IDDocuments[@i].ExpriredDate" class="form-control m-input datepicker" autocomplete="off" value="@iddocument.ExpriredDate" />
                                                    </div>
                                                    @if (i > 0)
                                                    {
                                                        <div class="col-lg-4">
                                                            <a class="m-portlet__nav-link btn m-btn m-btn--hover-danger m-btn--icon m-btn--icon-only m-btn--pill btn-deleteIDDocument" data-index="@i">
                                                                <i class="la la-trash"></i>
                                                            </a>
                                                        </div>
                                                    }
                                                </div>
                                            </div>
                                        </div>
                                    }
                                    <div hidden id="addIDDocumentTemplate">
                                        <div class="form-group m-form__group row pt-4 iddocument-item" data-index="{pIndex}">
                                            <div class="col-md-6">
                                                <div class="form-group m-form__group row">
                                                    <label class="col-lg-3 col-form-label">
                                                        Loại giấy tờ
                                                    </label>
                                                    <div class="col-lg-4">
                                                        <select name="IDDocuments[{pIndex}].IDDocumentTypeId" asp-items="@(new SelectList(ViewBag.IDDocumentTypes, "Id", "Value"))" class="form-control m-input m-input--square iddocument-type" data-index="{pIndex}">
                                                            <option value="" selected>Chọn</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="form-group m-form__group row">
                                                    <label class="col-lg-3 col-form-label">
                                                        Số
                                                    </label>
                                                    <div class="col-lg-4">
                                                        <input name="IDDocuments[{pIndex}].IDNumber" class="form-control m-input" autocomplete="off" />
                                                    </div>
                                                </div>
                                                <div class="form-group m-form__group row">
                                                    <label class="col-lg-3 col-form-label">
                                                        Nơi cấp
                                                    </label>
                                                    <div class="col-lg-9">
                                                        <input name="IDDocuments[{pIndex}].ProvidedPlace" class="form-control m-input" autocomplete="off" />
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="form-group m-form__group row">
                                                    <label class="col-lg-3 col-form-label">
                                                        Tên giấy tờ
                                                    </label>
                                                    <div class="col-lg-9">
                                                        <input data-index="{pIndex}" class="form-control m-input iddocument-name" autocomplete="off" readonly />
                                                    </div>
                                                </div>
                                                <div class="form-group m-form__group row">
                                                    <label class="col-lg-3 col-form-label">
                                                        Ngày hết hạn
                                                    </label>
                                                    <div class="col-lg-4">
                                                        <input name="IDDocuments[{pIndex}].ProvidedDate" class="form-control m-input datepicker" autocomplete="off" />
                                                    </div>
                                                </div>
                                                <div class="form-group m-form__group row">
                                                    <label class="col-lg-3 col-form-label">
                                                        Ngày cấp
                                                    </label>
                                                    <div class="col-lg-4">
                                                        <input name="IDDocuments[{pIndex}].ExpriredDate" class="form-control m-input datepicker" autocomplete="off" />
                                                    </div>
                                                    <div class="col-lg-4">
                                                        <input type="hidden" class="IsDeletedIDDocument" name="IDDocuments[{pIndex}].IsDeleted" value="false">
                                                        <a class="m-portlet__nav-link btn m-btn m-btn--hover-danger m-btn--icon m-btn--icon-only m-btn--pill btn-deleteIDDocument" data-index="{pIndex}">
                                                            <i class="la la-trash"></i>
                                                        </a>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group m-form__group row pt-2">
                                    <div class="col-lg-12 text-right">
                                        <button type="button" class="btn btn-secondary btn-sm" id="add-iddocument" data-index="@Model.IDDocuments.Count">Thêm giấy tờ tùy thân</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="m-portlet m-portlet--tab">
                            <div class="m-portlet__head">
                                <div class="m-portlet__head-caption">
                                    <div class="m-portlet__head-title">
                                        <span class="m-portlet__head-icon m--hide">
                                            <i class="la la-gear"></i>
                                        </span>
                                        <h3 class="m-portlet__head-text">
                                            Thông tin liên lạc
                                        </h3>
                                    </div>
                                </div>
                            </div>
                            <div class="m-portlet__body">
                                <div id="phone-container">
                                    <input type="hidden" name="ContactInfo.Id" value="@Model.ContactInfo.Id.">
                                    @for (var i = 0; i < Model.ContactInfo.Phones.Count; i++)
                                    {
                                        var phone = Model.ContactInfo.Phones.ElementAt(i);
                                        <div class="form-group m-form__group row phone-item" data-index="@i">
                                            <input type="hidden" name="ContactInfo.Phones[@i].Id" value="@phone.Id">
                                            <input type="hidden" class="IsDeletedPhone" name="ContactInfo.Phones[@i].IsDeleted" value="false">
                                            <label class="col-lg-2 col-form-label">
                                                Số điện thoại
                                            </label>
                                            <div class="col-lg-3">
                                                <select name="ContactInfo.Phones[@i].TypeId" asp-items="@(new SelectList(ViewBag.PhoneTypes, "Id", "Value", phone.TypeId))" class="form-control m-input m-input--square"></select>
                                            </div>
                                            <div class="col-lg-3">
                                                <input name="ContactInfo.Phones[@i].PhoneNumber" class="form-control m-input" autocomplete="off" value="@phone.PhoneNumber" />
                                            </div>
                                            <div class="col-lg-2">
                                                <label class="m-checkbox m-checkbox--focus">
                                                    <input type="checkbox" name="ContactInfo.Phones[@i].IsPrimary" @(phone.IsPrimary ? "checked" : "") value="true" />
                                                    SĐT chính
                                                    <span></span>
                                                </label>
                                            </div>
                                            <div class="col-lg-2">
                                                @if (i == 0)
                                                {
                                                    <button type="button" class="btn btn-secondary btn-sm" id="add-phone" data-index="@Model.ContactInfo.Phones.Count">Thêm SĐT</button>
                                                }
                                                else
                                                {
                                                    <a class="m-portlet__nav-link btn m-btn m-btn--hover-danger m-btn--icon m-btn--icon-only m-btn--pill btn-deletePhone" data-index="@i">
                                                        <i class="la la-trash"></i>
                                                    </a>
                                                }
                                            </div>
                                        </div>
                                    }
                                    <div hidden id="addPhoneTemplate">
                                        <div class="form-group m-form__group row phone-item" data-index="{pIndex}">
                                            <label class="col-lg-2 col-form-label">&nbsp;</label>
                                            <div class="col-lg-3">
                                                <select name="ContactInfo.Phones[{pIndex}].TypeId" asp-items="@(new SelectList(ViewBag.PhoneTypes, "Id", "Value"))" class="form-control m-input m-input--square"></select>
                                            </div>
                                            <div class="col-lg-3">
                                                <input name="ContactInfo.Phones[{pIndex}].PhoneNumber" class="form-control m-input" autocomplete="off" />
                                            </div>
                                            <div class="col-lg-2">
                                                <label class="m-checkbox m-checkbox--focus">
                                                    <input type="checkbox" name="ContactInfo.Phones[{pIndex}].IsPrimary" value="true" />
                                                    SĐT chính
                                                    <span></span>
                                                </label>
                                            </div>
                                            <div class="col-lg-2">
                                                <input type="hidden" class="IsDeletedPhone" name="ContactInfo.Phones[{pIndex}].IsDeleted" value="false">
                                                <a class="m-portlet__nav-link btn m-btn m-btn--hover-danger m-btn--icon m-btn--icon-only m-btn--pill btn-deletePhone" data-index="{pIndex}">
                                                    <i class="la la-trash"></i>
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div id="email-container">
                                    @for (var i = 0; i < Model.ContactInfo.Emails.Count; i++)
                                    {
                                        var email = Model.ContactInfo.Emails.ElementAt(i);
                                        <div class="form-group m-form__group row email-item @(i == 0 ? "mt-4" : "")" data-index="@i">
                                            <input type="hidden" name="ContactInfo.Emails[@i].Id" value="@email.Id">
                                            <input type="hidden" class="IsDeletedEmail" name="ContactInfo.Emails[@i].IsDeleted" value="false">
                                            <label class="col-lg-2 col-form-label">
                                                Email
                                            </label>
                                            <div class="col-lg-3">
                                                <select name="ContactInfo.Emails[@i].TypeId" asp-items="@(new SelectList(ViewBag.EmailTypes, "Id", "Value", email.TypeId))" class="form-control m-input m-input--square"></select>
                                            </div>
                                            <div class="col-lg-3">
                                                <input name="ContactInfo.Emails[@i].Email" class="form-control m-input" autocomplete="off" value="@email.Email" />
                                            </div>
                                            <div class="col-lg-2">
                                                <label class="m-checkbox m-checkbox--focus">
                                                    <input type="checkbox" name="ContactInfo.Emails[@i].IsPrimary" @(email.IsPrimary ? "checked" : "") value="true" />
                                                    Email chính
                                                    <span></span>
                                                </label>
                                            </div>
                                            <div class="col-lg-2">
                                                @if (i == 0)
                                                {
                                                    <button type="button" class="btn btn-secondary btn-sm" id="add-email" data-index="@Model.ContactInfo.Emails.Count">Thêm Email</button>
                                                }
                                                else
                                                {
                                                    <a class="m-portlet__nav-link btn m-btn m-btn--hover-danger m-btn--icon m-btn--icon-only m-btn--pill btn-deleteEmail" data-index="@i">
                                                        <i class="la la-trash"></i>
                                                    </a>
                                                }
                                            </div>
                                        </div>
                                    }
                                    <div hidden id="addEmailTemplate">
                                        <div class="form-group m-form__group row email-item" data-index="{pIndex}">
                                            <label class="col-lg-2 col-form-label">&nbsp;</label>
                                            <div class="col-lg-3">
                                                <select name="ContactInfo.Emails[{pIndex}].TypeId" asp-items="@(new SelectList(ViewBag.EmailTypes, "Id", "Value"))" class="form-control m-input m-input--square"></select>
                                            </div>
                                            <div class="col-lg-3">
                                                <input name="ContactInfo.Emails[{pIndex}].Email" class="form-control m-input" autocomplete="off" />
                                            </div>
                                            <div class="col-lg-2">
                                                <label class="m-checkbox m-checkbox--focus">
                                                    <input type="checkbox" name="ContactInfo.Emails[{pIndex}].IsPrimary" value="true" />
                                                    Email chính
                                                    <span></span>
                                                </label>
                                            </div>
                                            <div class="col-lg-2">
                                                <input type="hidden" class="IsDeletedEmail" name="ContactInfo.Emails[{pIndex}].IsDeleted" value="false">
                                                <a class="m-portlet__nav-link btn m-btn m-btn--hover-danger m-btn--icon m-btn--icon-only m-btn--pill btn-deleteEmail" data-index="{pIndex}">
                                                    <i class="la la-trash"></i>
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div id="address-container">
                                    @for (var i = 0; i < Model.ContactInfo.Addresses.Count; i++)
                                    {
                                        var address = Model.ContactInfo.Addresses.ElementAt(i);
                                        var districts = address.ProvinceId.HasValue ? allDistricts.Where(d => d.ProvinceId == address.ProvinceId.Value) : allDistricts;
                                        var wards = address.DistrictPlaceId.HasValue ? allWards.Where(w => w.DistrictPlaceId == address.DistrictPlaceId.Value) : null;
                                        <div class="form-group m-form__group row address-item @(i == 0 ? "mt-4" : "")" data-index="@i">
                                            <div class="col-lg-2 text-right">
                                                <label class="col-form-label">
                                                    Địa chỉ
                                                </label>
                                            </div>
                                            <div class="col-lg-8">
                                                <div class="form-group m-form__group row address-item">
                                                    <input type="hidden" name="ContactInfo.Addresses[@i].Id" value="@address.Id">
                                                    <input type="hidden" class="IsDeletedAddress" name="ContactInfo.Addresses[@i].IsDeleted" value="false">
                                                    <div class="col-lg-3">
                                                        <select name="ContactInfo.Addresses[@i].TypeId" asp-items="@(new SelectList(ViewBag.AddressTypes, "Id", "Value", address.TypeId))" class="form-control m-input m-input--square">
                                                            <option value="" selected>Chọn loại địa chỉ</option>
                                                        </select>
                                                    </div>
                                                    <div class="col-lg-6">
                                                        <input name="ContactInfo.Addresses[@i].MoreInfo" class="form-control m-input" placeholder="Địa chỉ" autocomplete="off" value="@address.MoreInfo" />
                                                    </div>
                                                    <div class="col-lg-3">
                                                        <select name="ContactInfo.Addresses[@i].WardId" class="form-control m-input m-input--square contact-ward" data-index="@i">
                                                            <option value="">Chọn phường</option>
                                                            @if (wards != null)
                                                            {
                                                                @foreach (var ward in wards)
                                                                {
                                                                    if (address.WardId.HasValue && ward.Id == address.WardId.Value)
                                                                    {
                                                                        <option value="@ward.Id" selected>@ward.Name</option>
                                                                    }
                                                                    else
                                                                    {
                                                                        <option value="@ward.Id">@ward.Name</option>
                                                                    }
                                                                }
                                                            }
                                                        </select>
                                                    </div>
                                                    <div class="col-lg-3">
                                                        <select name="ContactInfo.Addresses[@i].DistrictPlaceId" class="form-control m-input m-input--square contact-district" data-index="@i">
                                                            <option value="">Chọn quận</option>
                                                            @if (districts != null)
                                                            {
                                                                @foreach (var district in districts)
                                                                {
                                                                    if (address.DistrictPlaceId.HasValue && district.Id == address.DistrictPlaceId.Value)
                                                                    {
                                                                        <option value="@district.Id" data-parent="@district.ProvinceId" selected>@district.Name</option>
                                                                    }
                                                                    else
                                                                    {
                                                                        <option value="@district.Id" data-parent="@district.ProvinceId">@district.Name</option>
                                                                    }
                                                                }
                                                            }
                                                        </select>
                                                    </div>
                                                    <div class="col-lg-3">
                                                        <select name="ContactInfo.Addresses[@i].ProvinceId" asp-items="@(new SelectList(ViewBag.Provinces, "Id", "Name", address.ProvinceId))" class="form-control m-input m-input--square contact-province" data-index="@i">
                                                            <option value="" selected>Chọn tỉnh/thành</option>
                                                        </select>
                                                    </div>
                                                    <div class="col-lg-3">
                                                        <select name="ContactInfo.Addresses[@i].NationalityId" asp-items="@(new SelectList(ViewBag.Nationalities, "Id", "Value", address.NationalityId))" class="form-control m-input m-input--square contact-national" data-index="@i">
                                                            <option value="" selected>Chọn quốc gia</option>
                                                        </select>
                                                    </div>
                                                    <div class="col-lg-2">
                                                        <label class="m-checkbox m-checkbox--focus">
                                                            <input type="checkbox" name="ContactInfo.Addresses[@i].IsPrimary" @(address.IsPrimary ? "checked" : "") value="true" />
                                                            Địa chỉ chính
                                                            <span></span>
                                                        </label>
                                                    </div>
                                                    <div class="col-lg-1 text-right">
                                                        @if (i > 0)
                                                        {
                                                            <a class="m-portlet__nav-link btn m-btn m-btn--hover-danger m-btn--icon m-btn--icon-only m-btn--pill btn-deleteAddress" data-index="@i">
                                                                <i class="la la-trash"></i>
                                                            </a>
                                                        }
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-lg-2">
                                                <button type="button" class="btn btn-secondary btn-sm" id="add-address" data-index="@Model.ContactInfo.Addresses.Count">Thêm địa chỉ</button>
                                            </div>
                                        </div>
                                    }
                                    <div hidden id="addAddressTemplate">
                                        <div class="form-group m-form__group row address-item" data-index="{pIndex}">
                                            <div class="col-lg-2 text-right">
                                                <label class="col-form-label">&nbsp;</label>
                                            </div>
                                            <div class="col-lg-8">
                                                <div class="form-group m-form__group row">
                                                    <div class="col-lg-3">
                                                        <select name="ContactInfo.Addresses[{pIndex}].TypeId" asp-items="@(new SelectList(ViewBag.AddressTypes, "Id", "Value"))" class="form-control m-input m-input--square">
                                                            <option value="" selected>Chọn loại địa chỉ</option>
                                                        </select>
                                                    </div>
                                                    <div class="col-lg-6">
                                                        <input name="ContactInfo.Addresses[{pIndex}].MoreInfo" class="form-control m-input" placeholder="Địa chỉ" autocomplete="off" />
                                                    </div>
                                                    <div class="col-lg-3">
                                                        <select name="ContactInfo.Addresses[{pIndex}].WardId" class="form-control m-input m-input--square contact-ward" data-index="{pIndex}">
                                                            <option value="" selected>Chọn phường</option>
                                                        </select>
                                                    </div>
                                                    <div class="col-lg-3">
                                                        <select name="ContactInfo.Addresses[{pIndex}].DistrictPlaceId" class="form-control m-input m-input--square contact-district" data-index="{pIndex}">
                                                            <option value="" selected>Chọn quận</option>
                                                            @foreach (var district in allDistricts)
                                                            {
                                                                <option value="@district.Id" data-parent="@district.ProvinceId">@district.Name</option>
                                                            }
                                                        </select>
                                                    </div>
                                                    <div class="col-lg-3">
                                                        <select name="ContactInfo.Addresses[{pIndex}].ProvinceId" asp-items="@(new SelectList(ViewBag.Provinces, "Id", "Name"))" class="form-control m-input m-input--square contact-province" data-index="{pIndex}">
                                                            <option value="" selected>Chọn tỉnh/thành</option>
                                                        </select>
                                                    </div>
                                                    <div class="col-lg-3">
                                                        <select name="ContactInfo.Addresses[{pIndex}].NationalityId" asp-items="@(new SelectList(ViewBag.Nationalities, "Id", "Value"))" class="form-control m-input m-input--square contact-national" data-index="{pIndex}">
                                                            <option value="" selected>Chọn quốc gia</option>
                                                        </select>
                                                    </div>
                                                    <div class="col-lg-2">
                                                        <label class="m-checkbox m-checkbox--focus">
                                                            <input type="checkbox" name="ContactInfo.Addresses[{pIndex}].IsPrimary" value="true" />
                                                            Địa chỉ chính
                                                            <span></span>
                                                        </label>
                                                    </div>
                                                    <div class="col-lg-1 text-right">
                                                        <input type="hidden" class="IsDeletedAddress" name="ContactInfo.Addresses[{pIndex}].IsDeleted" value="false">
                                                        <a class="m-portlet__nav-link btn m-btn m-btn--hover-danger m-btn--icon m-btn--icon-only m-btn--pill btn-deleteAddress" data-index="{pIndex}">
                                                            <i class="la la-trash"></i>
                                                        </a>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div id="social-container">
                                    @for (var i = 0; i < Model.ContactInfo.Socials.Count; i++)
                                    {
                                        var social = Model.ContactInfo.Socials.ElementAt(i);
                                        <div class="form-group m-form__group row social-item @(i == 0 ? "mt-4" : "")" data-index="@i">
                                            <input type="hidden" name="ContactInfo.Socials[@i].Id" value="@social.Id">
                                            <input type="hidden" class="IsDeletedSocial" name="ContactInfo.Socials[@i].IsDeleted" value="false">
                                            <label class="col-lg-2 col-form-label">
                                                Mạng xã hội
                                            </label>
                                            <div class="col-lg-3">
                                                <select name="ContactInfo.Socials[@i].TypeId" asp-items="@(new SelectList(ViewBag.SocialTypes, "Id", "Value", social.TypeId))" class="form-control m-input m-input--square"></select>
                                            </div>
                                            <div class="col-lg-3">
                                                <input name="ContactInfo.Socials[@i].Account" class="form-control m-input" autocomplete="off" value="@social.Account" />
                                            </div>
                                            <div class="col-lg-2">
                                                <label class="m-checkbox m-checkbox--focus">
                                                    <input type="checkbox" name="ContactInfo.Socials[@i].IsPrimary" @(social.IsPrimary ? "checked" : "") value="true" />
                                                    MXH chính
                                                    <span></span>
                                                </label>
                                            </div>
                                            <div class="col-lg-2">
                                                @if (i == 0)
                                                {
                                                    <button type="button" class="btn btn-secondary btn-sm" id="add-social" data-index="@Model.ContactInfo.Socials.Count">Thêm MXH</button>
                                                }
                                                else
                                                {
                                                    <a class="m-portlet__nav-link btn m-btn m-btn--hover-danger m-btn--icon m-btn--icon-only m-btn--pill btn-deleteSocial" data-index="@i">
                                                        <i class="la la-trash"></i>
                                                    </a>
                                                }
                                            </div>
                                        </div>
                                    }
                                    <div hidden id="addSocialTemplate">
                                        <div class="form-group m-form__group row social-item" data-index="{pIndex}">
                                            <label class="col-lg-2 col-form-label">&nbsp;</label>
                                            <div class="col-lg-3">
                                                <select name="ContactInfo.Socials[{pIndex}].TypeId" asp-items="@(new SelectList(ViewBag.SocialTypes, "Id", "Value"))" class="form-control m-input m-input--square"></select>
                                            </div>
                                            <div class="col-lg-3">
                                                <input name="ContactInfo.Socials[{pIndex}].Account" class="form-control m-input" autocomplete="off" />
                                            </div>
                                            <div class="col-lg-2">
                                                <label class="m-checkbox m-checkbox--focus">
                                                    <input type="checkbox" name="ContactInfo.Socials[{pIndex}].IsPrimary" value="true" />
                                                    MXH chính
                                                    <span></span>
                                                </label>
                                            </div>
                                            <div class="col-lg-2">
                                                <input type="hidden" class="IsDeletedSocial" name="ContactInfo.Socials[{pIndex}].IsDeleted" value="false">
                                                <a class="m-portlet__nav-link btn m-btn m-btn--hover-danger m-btn--icon m-btn--icon-only m-btn--pill btn-deleteSocial" data-index="{pIndex}">
                                                    <i class="la la-trash"></i>
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div id="ott-container">
                                    @for (var i = 0; i < Model.ContactInfo.OTTs.Count; i++)
                                    {
                                        var ott = Model.ContactInfo.OTTs.ElementAt(i);
                                        <div class="form-group m-form__group row ott-item @(i == 0 ? "mt-4" : "")" data-index="@i">
                                            <input type="hidden" name="ContactInfo.OTTs[@i].Id" value="@ott.Id">
                                            <input type="hidden" class="IsDeletedOTT" name="ContactInfo.OTTs[@i].IsDeleted" value="false">
                                            <label class="col-lg-2 col-form-label">
                                                OTT
                                            </label>
                                            <div class="col-lg-3">
                                                <select name="ContactInfo.OTTs[@i].TypeId" asp-items="@(new SelectList(ViewBag.OTTTypes, "Id", "Value", ott.TypeId))" class="form-control m-input m-input--square"></select>
                                            </div>
                                            <div class="col-lg-3">
                                                <input name="ContactInfo.OTTs[@i].Account" class="form-control m-input" autocomplete="off" value="@ott.Account" />
                                            </div>
                                            <div class="col-lg-2">
                                                <label class="m-checkbox m-checkbox--focus">
                                                    <input type="checkbox" name="ContactInfo.OTTs[@i].IsPrimary" @(ott.IsPrimary ? "checked" : "") value="true" />
                                                    OTT chính
                                                    <span></span>
                                                </label>
                                            </div>
                                            <div class="col-lg-2">
                                                @if (i == 0)
                                                {
                                                    <button type="button" class="btn btn-secondary btn-sm" id="add-ott" data-index="@Model.ContactInfo.OTTs.Count">Thêm OTT</button>
                                                }
                                                else
                                                {
                                                    <a class="m-portlet__nav-link btn m-btn m-btn--hover-danger m-btn--icon m-btn--icon-only m-btn--pill btn-deleteOTT" data-index="@i">
                                                        <i class="la la-trash"></i>
                                                    </a>
                                                }
                                            </div>
                                        </div>
                                    }
                                    <div hidden id="addOTTTemplate">
                                        <div class="form-group m-form__group row ott-item" data-index="{pIndex}">
                                            <label class="col-lg-2 col-form-label">&nbsp;</label>
                                            <div class="col-lg-3">
                                                <select name="ContactInfo.OTTs[{pIndex}].TypeId" asp-items="@(new SelectList(ViewBag.OTTTypes, "Id", "Value"))" class="form-control m-input m-input--square"></select>
                                            </div>
                                            <div class="col-lg-3">
                                                <input name="ContactInfo.OTTs[{pIndex}].Account" class="form-control m-input" autocomplete="off" />
                                            </div>
                                            <div class="col-lg-2">
                                                <label class="m-checkbox m-checkbox--focus">
                                                    <input type="checkbox" name="ContactInfo.OTTs[{pIndex}].IsPrimary" value="true" />
                                                    OTT chính
                                                    <span></span>
                                                </label>
                                            </div>
                                            <div class="col-lg-2">
                                                <input type="hidden" class="IsDeletedOTT" name="ContactInfo.OTTs[{pIndex}].IsDeleted" value="false">
                                                <a class="m-portlet__nav-link btn m-btn m-btn--hover-danger m-btn--icon m-btn--icon-only m-btn--pill btn-deleteOTT" data-index="{pIndex}">
                                                    <i class="la la-trash"></i>
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="m-portlet m-portlet--tab">
                            <div class="m-portlet__head">
                                <div class="m-portlet__head-caption">
                                    <div class="m-portlet__head-title">
                                        <span class="m-portlet__head-icon m--hide">
                                            <i class="la la-gear"></i>
                                        </span>
                                        <h3 class="m-portlet__head-text">
                                            Thanh toán - Ngân hàng
                                        </h3>
                                    </div>
                                </div>
                            </div>
                            <div class="m-portlet__body">
                                <div id="bank-container">
                                    @for (var i = 0; i < Model.PersonBanks.Count; i++)
                                    {
                                        var bank = Model.PersonBanks.ElementAt(i);
                                        <div class="form-group m-form__group row bank-item @(i > 0 ? "pt-4" : "")" data-index="@i">
                                            <div class="col-lg-12">
                                                <div class="form-group m-form__group row">
                                                    <input type="hidden" name="PersonBanks[@i].Id" value="@bank.Id">
                                                    <input type="hidden" class="IsDeletedBank" name="PersonBanks[@i].IsDeleted" value="false">
                                                    <div class="col-lg-12">
                                                        <div class="form-group m-form__group row">
                                                            <div class="col-md-6">
                                                                <div class="form-group m-form__group row">
                                                                    <label class="col-lg-3 col-form-label">
                                                                        Số tài khoản
                                                                    </label>
                                                                    <div class="col-lg-4">
                                                                        <input name="PersonBanks[@i].AccountNumber" class="form-control m-input" autocomplete="off" value="@bank.AccountNumber" />
                                                                    </div>
                                                                </div>
                                                                <div class="form-group m-form__group row">
                                                                    <label class="col-lg-3 col-form-label">
                                                                        Tên tài khoản
                                                                    </label>
                                                                    <div class="col-lg-9">
                                                                        <input name="PersonBanks[@i].AccountName" class="form-control m-input" autocomplete="off" value="@bank.AccountName" />
                                                                    </div>
                                                                </div>
                                                                <div class="form-group m-form__group row">
                                                                    <label class="col-lg-3 col-form-label">
                                                                        Loại tài khoản
                                                                    </label>
                                                                    <div class="col-lg-4">
                                                                        <select name="PersonBanks[@i].BankAccountTypeId" asp-items="@(new SelectList(ViewBag.BankAccountTypes, "Id", "Value", bank.BankAccountTypeId))" class="form-control m-input m-input--square">
                                                                            <option value="" selected>Chọn</option>
                                                                        </select>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="col-md-6">
                                                                <div class="form-group m-form__group row">
                                                                    <label class="col-lg-3 col-form-label">
                                                                        Ngân hàng
                                                                    </label>
                                                                    <div class="col-lg-4">
                                                                        <input name="PersonBanks[@i].BankName" class="form-control m-input" autocomplete="off" value="@bank.BankName" />
                                                                    </div>
                                                                    @if (i > 0)
                                                                    {
                                                                        <div class="col-lg-5">
                                                                            <a class="m-portlet__nav-link btn m-btn m-btn--hover-danger m-btn--icon m-btn--icon-only m-btn--pill btn-deleteBank" data-index="@i">
                                                                                <i class="la la-trash"></i>
                                                                            </a>
                                                                        </div>
                                                                    }
                                                                </div>
                                                                <div class="form-group m-form__group row">
                                                                    <label class="col-lg-3 col-form-label">
                                                                        Swift Code
                                                                    </label>
                                                                    <div class="col-lg-4">
                                                                        <input name="PersonBanks[@i].SwiftCode" class="form-control m-input" autocomplete="off" value="@bank.SwiftCode" />
                                                                    </div>
                                                                </div>
                                                                <div class="form-group m-form__group row">
                                                                    <label class="col-lg-3 col-form-label">
                                                                        Chi nhánh
                                                                    </label>
                                                                    <div class="col-lg-4">
                                                                        <input name="PersonBanks[@i].BankBranch" class="form-control m-input" autocomplete="off" value="@bank.BankBranch" />
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="form-group m-form__group row">
                                                            <div class="col-lg-12">
                                                                <div class="form-group m-form__group row">
                                                                    <div class="col-lg-12" id="card-container-0">
                                                                        @for (var j = 0; j < bank.BankCards.Count; j++)
                                                                        {
                                                                            var card = bank.BankCards.ElementAt(j);
                                                                            <div class="form-group m-form__group row card-item" data-parent="@i" data-index="@j">
                                                                                <input type="hidden" name="PersonBanks[@i].BankCards[@j].Id" value="@card.Id">
                                                                                <input type="hidden" class="IsDeletedCard" name="PersonBanks[@i].BankCards[@j].IsDeleted" value="false">
                                                                                <div class="col-lg-6">
                                                                                    <div class="form-group m-form__group row">
                                                                                        <label class="col-lg-3 col-form-label">
                                                                                            Loại thẻ thanh toán
                                                                                        </label>
                                                                                        <div class="col-lg-4">
                                                                                            <select name="PersonBanks[@i].BankCards[@j].BankCardTypeId" asp-items="@(new SelectList(ViewBag.BankCardTypes, "Id", "Value", card.BankCardTypeId))" class="form-control m-input m-input--square">
                                                                                                <option value="" selected>Chọn</option>
                                                                                            </select>
                                                                                        </div>
                                                                                    </div>
                                                                                    <div class="form-group m-form__group row">
                                                                                        <label class="col-lg-3 col-form-label">
                                                                                            Số thẻ thanh toán
                                                                                        </label>
                                                                                        <div class="col-lg-4">
                                                                                            <input name="PersonBanks[@i].BankCards[@j].CardNumber" class="form-control m-input" autocomplete="off" value="@card.CardNumber" />
                                                                                        </div>
                                                                                    </div>
                                                                                </div>
                                                                                <div class="col-lg-6">
                                                                                    <div class="form-group m-form__group row">
                                                                                        <label class="col-lg-3 col-form-label">&nbsp;</label>
                                                                                        <div class="col-lg-9">&nbsp;</div>
                                                                                    </div>
                                                                                    <div class="form-group m-form__group row">
                                                                                        <label class="col-lg-3 col-form-label">
                                                                                            Ngày hết hạn thẻ
                                                                                        </label>
                                                                                        <div class="col-lg-4">
                                                                                            <input name="PersonBanks[@i].BankCards[@j].ExpiredDate" class="form-control m-input" autocomplete="off" value="@card.ExpiredDate" />
                                                                                        </div>
                                                                                        @if (j > 0)
                                                                                        {
                                                                                            <div class="col-lg-5">
                                                                                                <a class="m-portlet__nav-link btn m-btn m-btn--hover-danger m-btn--icon m-btn--icon-only m-btn--pill btn-deleteCard" data-parent="@i" data-index="@j">
                                                                                                    <i class="la la-trash"></i>
                                                                                                </a>
                                                                                            </div>
                                                                                        }
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                        }
                                                                    </div>
                                                                </div>
                                                                <div class="form-group m-form__group row pb-2">
                                                                    <div class="col-lg-12 text-right">
                                                                        <button type="button" class="btn btn-secondary btn-sm add-card" data-parent="0" data-index="@bank.BankCards.Count">Thêm thẻ thanh toán</button>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    }
                                </div>
                                <div hidden id="addBankTemplate">
                                    <div class="form-group m-form__group row pt-4 bank-item" data-index="{pIndex}">
                                        <div class="col-lg-12">
                                            <div class="form-group m-form__group row">
                                                <div class="col-lg-12">
                                                    <div class="form-group m-form__group row">
                                                        <div class="col-md-6">
                                                            <div class="form-group m-form__group row">
                                                                <label class="col-lg-3 col-form-label">
                                                                    Số tài khoản
                                                                </label>
                                                                <div class="col-lg-4">
                                                                    <input name="PersonBanks[{pIndex}].AccountNumber" class="form-control m-input" autocomplete="off" />
                                                                </div>
                                                            </div>
                                                            <div class="form-group m-form__group row">
                                                                <label class="col-lg-3 col-form-label">
                                                                    Tên tài khoản
                                                                </label>
                                                                <div class="col-lg-9">
                                                                    <input name="PersonBanks[{pIndex}].AccountName" class="form-control m-input" autocomplete="off" />
                                                                </div>
                                                            </div>
                                                            <div class="form-group m-form__group row">
                                                                <label class="col-lg-3 col-form-label">
                                                                    Loại tài khoản
                                                                </label>
                                                                <div class="col-lg-4">
                                                                    <select name="PersonBanks[{pIndex}].BankAccountTypeId" asp-items="@(new SelectList(ViewBag.BankAccountTypes, "Id", "Value"))" class="form-control m-input m-input--square">
                                                                        <option value="" selected>Chọn</option>
                                                                    </select>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-6">
                                                            <div class="form-group m-form__group row">
                                                                <label class="col-lg-3 col-form-label">
                                                                    Ngân hàng
                                                                </label>
                                                                <div class="col-lg-4">
                                                                    <input name="PersonBanks[{pIndex}].BankName" class="form-control m-input" autocomplete="off" />
                                                                </div>
                                                                <div class="col-lg-5">
                                                                    <input type="hidden" class="IsDeletedBank" name="PersonBanks[{pIndex}].IsDeleted" value="false">
                                                                    <a class="m-portlet__nav-link btn m-btn m-btn--hover-danger m-btn--icon m-btn--icon-only m-btn--pill btn-deleteBank" data-index="{pIndex}">
                                                                        <i class="la la-trash"></i>
                                                                    </a>
                                                                </div>
                                                            </div>
                                                            <div class="form-group m-form__group row">
                                                                <label class="col-lg-3 col-form-label">
                                                                    Swift Code
                                                                </label>
                                                                <div class="col-lg-4">
                                                                    <input name="PersonBanks[{pIndex}].SwiftCode" class="form-control m-input" autocomplete="off" />
                                                                </div>
                                                            </div>
                                                            <div class="form-group m-form__group row">
                                                                <label class="col-lg-3 col-form-label">
                                                                    Chi nhánh
                                                                </label>
                                                                <div class="col-lg-4">
                                                                    <input name="PersonBanks[{pIndex}].BankBranch" class="form-control m-input" autocomplete="off" />
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="form-group m-form__group row">
                                                        <div class="col-lg-12">
                                                            <div class="form-group m-form__group row">
                                                                <div class="col-lg-12" id="card-container-{pIndex}">
                                                                    <div class="form-group m-form__group row card-item">
                                                                        <input type="hidden" class="IsDeletedCard" name="PersonBanks[{pIndex}].BankCards[0].IsDeleted" value="false">
                                                                        <div class="col-lg-6">
                                                                            <div class="form-group m-form__group row">
                                                                                <label class="col-lg-3 col-form-label">
                                                                                    Loại thẻ thanh toán
                                                                                </label>
                                                                                <div class="col-lg-4">
                                                                                    <select name="PersonBanks[{pIndex}].BankCards[0].BankCardTypeId" asp-items="@(new SelectList(ViewBag.BankCardTypes, "Id", "Value"))" class="form-control m-input m-input--square">
                                                                                        <option value="" selected>Chọn</option>
                                                                                    </select>
                                                                                </div>
                                                                            </div>
                                                                            <div class="form-group m-form__group row">
                                                                                <label class="col-lg-3 col-form-label">
                                                                                    Số thẻ thanh toán
                                                                                </label>
                                                                                <div class="col-lg-4">
                                                                                    <input name="PersonBanks[{pIndex}].BankCards[0].CardNumber" class="form-control m-input" autocomplete="off" />
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                        <div class="col-lg-6">
                                                                            <div class="form-group m-form__group row">
                                                                                <label class="col-lg-3 col-form-label">&nbsp;</label>
                                                                                <div class="col-lg-9">&nbsp;</div>
                                                                            </div>
                                                                            <div class="form-group m-form__group row">
                                                                                <label class="col-lg-3 col-form-label">
                                                                                    Ngày hết hạn thẻ
                                                                                </label>
                                                                                <div class="col-lg-4">
                                                                                    <input name="PersonBanks[{pIndex}].BankCards[0].ExpiredDate" class="form-control m-input" autocomplete="off" />
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="form-group m-form__group row pb-2">
                                                                <div class="col-lg-12 text-right">
                                                                    <button type="button" class="btn btn-secondary btn-sm add-card" data-parent="{pIndex}" data-index="1">Thêm thẻ thanh toán</button>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div hidden id="addCardTemplate">
                                    <div class="form-group m-form__group row card-item" data-parent="{bIndex}" data-index="{pIndex}">
                                        <div class="col-lg-6">
                                            <div class="form-group m-form__group row">
                                                <label class="col-lg-3 col-form-label">
                                                    Loại thẻ thanh toán
                                                </label>
                                                <div class="col-lg-4">
                                                    <select name="PersonBanks[{bIndex}].BankCards[{pIndex}].BankCardTypeId" asp-items="@(new SelectList(ViewBag.BankCardTypes, "Id", "Value"))" class="form-control m-input m-input--square">
                                                        <option value="" selected>Chọn</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="form-group m-form__group row">
                                                <label class="col-lg-3 col-form-label">
                                                    Số thẻ thanh toán
                                                </label>
                                                <div class="col-lg-4">
                                                    <input name="PersonBanks[{bIndex}].BankCards[{pIndex}].CardNumber" class="form-control m-input" autocomplete="off" />
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-lg-6">
                                            <div class="form-group m-form__group row">
                                                <label class="col-lg-3 col-form-label">&nbsp;</label>
                                                <div class="col-lg-9">&nbsp;</div>
                                            </div>
                                            <div class="form-group m-form__group row">
                                                <label class="col-lg-3 col-form-label">
                                                    Ngày hết hạn thẻ
                                                </label>
                                                <div class="col-lg-4">
                                                    <input name="PersonBanks[{bIndex}].BankCards[{pIndex}].ExpiredDate" class="form-control m-input" autocomplete="off" />
                                                </div>
                                                <div class="col-lg-5">
                                                    <input type="hidden" class="IsDeletedCard" name="PersonBanks[{bIndex}].BankCards[{pIndex}].IsDeleted" value="false">
                                                    <a class="m-portlet__nav-link btn m-btn m-btn--hover-danger m-btn--icon m-btn--icon-only m-btn--pill btn-deleteCard" data-parent="{bIndex}" data-index="{pIndex}">
                                                        <i class="la la-trash"></i>
                                                    </a>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group m-form__group row pt-2">
                                    <div class="col-lg-12 text-right">
                                        <button type="button" class="btn btn-secondary btn-sm" id="add-bank" data-index="@Model.PersonBanks.Count">Thêm tài khoản ngân hàng</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="m-portlet m-portlet--tab">
                            <div class="m-portlet__head">
                                <div class="m-portlet__head-caption">
                                    <div class="m-portlet__head-title">
                                        <span class="m-portlet__head-icon m--hide">
                                            <i class="la la-gear"></i>
                                        </span>
                                        <h3 class="m-portlet__head-text">
                                            Thông tin công việc
                                        </h3>
                                    </div>
                                </div>
                            </div>
                            <div class="m-portlet__body">
                                @if (Model.PersonType == PersonType.Employee)
                                {
                                    <div class="form-group m-form__group row">
                                        <div class="col-lg-6">
                                            <div class="form-group m-form__group row">
                                                <label class="col-lg-4 col-form-label">
                                                    Trạng thái
                                                </label>
                                                <div class="col-lg-4">
                                                    <label class="m-checkbox m-checkbox--focus">
                                                        <input type="checkbox" id="pewIsWorking" />
                                                        Đang làm
                                                        <span></span>
                                                    </label>
                                                </div>
                                            </div>
                                            <div class="form-group m-form__group row">
                                                <label class="col-lg-4 col-form-label">
                                                    Ngày bắt đầu thử việc
                                                </label>
                                                <div class="col-lg-4">
                                                    <input id="pewTrialWorkDate" class="form-control m-input datepicker" autocomplete="off" />
                                                </div>
                                            </div>
                                            <div class="form-group m-form__group row">
                                                <label class="col-lg-4 col-form-label">
                                                    Ngày được nhận chính thức
                                                </label>
                                                <div class="col-lg-4">
                                                    <input id="pewWorkDate" class="form-control m-input datepicker" autocomplete="off" />
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-lg-6">
                                            <div class="form-group m-form__group row">
                                                <label class="col-lg-4 col-form-label">
                                                    Chức vụ
                                                </label>
                                                <div class="col-lg-4">
                                                    <select id="pewPosition" asp-items="@(new SelectList(ViewBag.DepartmentPositions, "Id", "Name"))" class="form-control m-input m-input--square">
                                                        <option value="" selected>Chọn</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="form-group m-form__group row">
                                                <label class="col-lg-4 col-form-label">
                                                    Phòng ban
                                                </label>
                                                <div class="col-lg-4">
                                                    <select id="pewDepartment" asp-items="@(new SelectList(ViewBag.Departments, "Id", "Name"))" class="form-control m-input m-input--square">
                                                        <option value="" selected>Chọn</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="form-group m-form__group row">
                                                <label class="col-lg-4 col-form-label">
                                                    Ngày bắt đầu nhận chức vụ
                                                </label>
                                                <div class="col-lg-4">
                                                    <input id="pewStartDate" class="form-control m-input datepicker" autocomplete="off" />
                                                </div>
                                            </div>
                                            <div class="form-group m-form__group row">
                                                <label class="col-lg-4 col-form-label">
                                                    Ngày kết thúc chức vụ
                                                </label>
                                                <div class="col-lg-4">
                                                    <input id="pewEndDate" class="form-control m-input datepicker" autocomplete="off" />
                                                </div>
                                            </div>
                                            <div class="form-group m-form__group row">
                                                <div class="col-lg-4">&nbsp;</div>
                                                <div class="col-lg-8">
                                                    <label class="m-checkbox m-checkbox--focus">
                                                        <input type="checkbox" id="pewIsMainPosition" />
                                                        Chúc vụ chính
                                                        <span></span>
                                                    </label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group m-form__group row">
                                        <div class="col-lg-12 text-right">
                                            <button type="button" class="btn btn-secondary btn-sm" id="add-pew" data-index="@Model.PersonEmployeeWorkings.Count">Thêm chức vụ</button>
                                        </div>
                                    </div>
                                    <div class="form-group m-form__group row">
                                        <div class="col-lg-12">
                                            <h5>Lịch sử chuyển đổi công việc</h5>
                                            <table class="table table-striped- table-bordered table-hover table-checkable">
                                                <thead>
                                                    <tr class="text-center">
                                                        <th>Chức vụ</th>
                                                        <th>Phòng ban</th>
                                                        <th>Chức vụ chính</th>
                                                        <th>Đang làm</th>
                                                        <th>Ngày bắt đầu nhận chức vụ</th>
                                                        <th>Ngày kết thúc chức vụ</th>
                                                        <th></th>
                                                    </tr>
                                                </thead>
                                                <tbody id="pew-history">
                                                    @for (var i = 0; i < Model.PersonEmployeeWorkings.Count; i++)
                                                    {
                                                        var eWorking = Model.PersonEmployeeWorkings.ElementAt(i);
                                                        @await Component.InvokeAsync("PersonEmployeeWorking", new {
                                                           model = new PersonEmployeeWorkingViewModel
                                                           {
                                                               Id = eWorking.Id,
                                                               Index = i,
                                                               DepartmentId = eWorking.DepartmentId,
                                                               Department = eWorking.Department.Name,
                                                               DepartmentPositionId = eWorking.DepartmentPositionId,
                                                               Position = eWorking.DepartmentPosition.Name,
                                                               TrialWorkBeginDate = eWorking.TrialWorkBeginDate,
                                                               WorkBeginDate = eWorking.WorkBeginDate,
                                                               PositionBeginDate = eWorking.PositionBeginDate,
                                                               PositionEndDate = eWorking.PositionEndDate,
                                                               PersonId = eWorking.PersonId,
                                                               IsMainPosition = eWorking.IsMainPosition,
                                                               IsWorking = eWorking.IsWorking
                                                           }
                                                       })
                                                    }
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                }
                                else
                                {
                                    <div class="form-group m-form__group row">
                                        <div class="col-lg-6">
                                            <div class="form-group m-form__group row">
                                                <label class="col-lg-2 col-form-label">
                                                    Trạng thái
                                                </label>
                                                <div class="col-lg-4">
                                                    <label class="m-checkbox m-checkbox--focus">
                                                        <input type="checkbox" id="pcwIsWorking" />
                                                        Đang làm
                                                        <span></span>
                                                    </label>
                                                </div>
                                            </div>
                                            <div class="form-group m-form__group row">
                                                <label class="col-lg-2 col-form-label">
                                                    Chức vụ
                                                </label>
                                                <div class="col-lg-4">
                                                    <input id="pcwPosition" class="form-control m-input" autocomplete="off" />
                                                </div>
                                            </div>
                                            <div class="form-group m-form__group row">
                                                <label class="col-lg-2 col-form-label">
                                                    Phòng ban
                                                </label>
                                                <div class="col-lg-4">
                                                    <input id="pcwDepartment" class="form-control m-input" autocomplete="off" />
                                                </div>
                                            </div>
                                            <div class="form-group m-form__group row">
                                                <label class="col-lg-2 col-form-label">
                                                    Công ty
                                                </label>
                                                <div class="col-lg-4">
                                                    <input id="pcwCompany" class="form-control m-input" autocomplete="off" />
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-lg-6">
                                            <div class="form-group m-form__group row">
                                                <label class="col-lg-4 col-form-label">
                                                    Ngày bắt đầu nhận chức vụ
                                                </label>
                                                <div class="col-lg-4">
                                                    <input id="pcwStartDate" class="form-control m-input datepicker" autocomplete="off" />
                                                </div>
                                            </div>
                                            <div class="form-group m-form__group row">
                                                <label class="col-lg-4 col-form-label">
                                                    Ngày kết thúc chức vụ
                                                </label>
                                                <div class="col-lg-4">
                                                    <input id="pcwEndDate" class="form-control m-input datepicker" autocomplete="off" />
                                                </div>
                                            </div>
                                            <div class="form-group m-form__group row">
                                                <div class="col-lg-4">&nbsp;</div>
                                                <div class="col-lg-8">
                                                    <label class="m-checkbox m-checkbox--focus">
                                                        <input type="checkbox" id="pcwIsMainPosition" />
                                                        Chúc vụ chính
                                                        <span></span>
                                                    </label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group m-form__group row">
                                        <div class="col-lg-12 text-right">
                                            <button type="button" class="btn btn-secondary btn-sm" id="add-pcw" data-index="@Model.PersonCustomerWorkings.Count">Thêm chức vụ</button>
                                        </div>
                                    </div>
                                    <div class="form-group m-form__group row">
                                        <div class="col-lg-12">
                                            <h5>Lịch sử chuyển đổi công việc</h5>
                                            <table class="table table-striped- table-bordered table-hover table-checkable">
                                                <thead>
                                                    <tr class="text-center">
                                                        <th>Chức vụ</th>
                                                        <th>Phòng ban</th>
                                                        <th>Công ty/Tổ chức</th>
                                                        <th>Chức vụ chính</th>
                                                        <th>Đang làm</th>
                                                        <th>Ngày bắt đầu nhận chức vụ</th>
                                                        <th>Ngày kết thúc chức vụ</th>
                                                        <th></th>
                                                    </tr>
                                                </thead>
                                                <tbody id="pcw-history">
                                                    @for (var i = 0; i < Model.PersonCustomerWorkings.Count; i++)
                                                    {
                                                        var pWorking = Model.PersonCustomerWorkings.ElementAt(i);
                                                        @await Component.InvokeAsync("PersonCustomerWorking", new {
                                                            model = new PersonCustomerWorkingViewModel {
                                                                Id = pWorking.Id,
                                                                Index = i,
                                                                Company = pWorking.Company,
                                                                Department = pWorking.Department,
                                                                Position = pWorking.Position,
                                                                EndDate = pWorking.EndDate,
                                                                StartDate = pWorking.StartDate,
                                                                PersonId = pWorking.PersonId,
                                                                IsMainPosition = pWorking.IsMainPosition,
                                                                IsWorking = pWorking.IsWorking
                                                            }
                                                        })
                                                    }
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                }
                            </div>
                        </div>
                        @if (Model.PersonType == PersonType.Customer)
                        {
                            <div class="m-portlet m-portlet--tab">
                                <div class="m-portlet__head">
                                    <div class="m-portlet__head-caption">
                                        <div class="m-portlet__head-title">
                                            <span class="m-portlet__head-icon m--hide">
                                                <i class="la la-gear"></i>
                                            </span>
                                            <h3 class="m-portlet__head-text">
                                                Nhân viên chăm sóc
                                            </h3>
                                        </div>
                                    </div>
                                </div>
                                <div class="m-portlet__body">
                                    <div class="form-group m-form__group row">
                                        <div class="col-lg-12 text-right">
                                            <button type="button" class="btn btn-secondary btn-sm" id="add-pcc" data-index="@Model.CustomerRepresentativeCares.Count">Thêm nhân viên chăm sóc</button>
                                        </div>
                                    </div>
                                    <div class="form-group m-form__group row">
                                        <div class="col-lg-12">
                                            <table class="table table-striped- table-bordered table-hover table-checkable">
                                                <thead>
                                                    <tr class="text-center">
                                                        <th>Ngày bắt đầu tiếp nhận</th>
                                                        <th>Ngày dừng tiếp nhận</th>
                                                        <th>Nhân viên chăm sóc</th>
                                                        <th></th>
                                                    </tr>
                                                </thead>
                                                <tbody id="pcc-history">
                                                    @for (var i = 0; i < Model.CustomerRepresentativeCares.Count; i++)
                                                    {
                                                        var pcc = Model.CustomerRepresentativeCares.ElementAt(i);
                                                        @await Component.InvokeAsync("PersonCustomerCare", new {
                                                            model = new PersonCustomerCareViewModel {
                                                                Id = pcc.Id,
                                                                Index = i,
                                                                EndDate = pcc.EndDate,
                                                                StartDate = pcc.StartDate,
                                                                PersonId = pcc.PersonId,
                                                                EmployeeId = pcc.EmployeeId,
                                                                EmployeeName = pcc.Employee.PrimaryName
                                                            }
                                                        })
                                                    }
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        }

                        @if (Model.PersonType == PersonType.Employee)
                        {
                            <div class="m-portlet m-portlet--tab">
                                <div class="m-portlet__head">
                                    <div class="m-portlet__head-caption">
                                        <div class="m-portlet__head-title">
                                            <span class="m-portlet__head-icon m--hide">
                                                <i class="la la-gear"></i>
                                            </span>
                                            <h3 class="m-portlet__head-text">
                                                Tài khoản đăng nhập
                                            </h3>
                                        </div>
                                    </div>
                                </div>
                                <div class="m-portlet__body">
                                    <input asp-for="IsHaveAccount" type="hidden" />
                                    <input name="PersonUser.OldUserId" type="hidden" value="@Model.PersonUser.OldUserId" />
                                    <input name="PersonUser.UserId" id="peUserId" type="hidden" value="@Model.PersonUser.UserId" />
                                    <input name="PersonUser.IsMapAccount" id="peIsMapAccount" type="hidden" value="false" />
                                    <div class="form-group m-form__group row">
                                        <label class="col-lg-2 col-form-label">Tên đăng nhập</label>
                                        <div class="col-lg-3">
                                            <input type="text" id="peUsername" name="PersonUser.UserName" class="form-control m-input" autocomplete="false" style="text-transform: lowercase;" value="@Model.PersonUser?.UserName" @(Model.IsHaveAccount ? "readonly" : "") />
                                        </div>
                                        <div class="col-lg-3 row-select-username" style="display: @(Model.IsHaveAccount ? "none" : "flex")">
                                            <select id="selectedUserName" asp-items="@(new SelectList(ViewBag.AvailableUsers, "Id", "UserName"))" class="form-control m-input m-input--square">
                                                <option value="" selected>Chọn tên đăng nhập</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="form-group m-form__group row row-password" style="display: @(Model.IsHaveAccount ? "none" : "flex")">
                                        <label class="col-lg-2 col-form-label">Mật khẩu</label>
                                        <div class="col-lg-3">
                                            <input type="password" id="pePassword" name="PersonUser.Password" class="form-control m-input" autocomplete="new-password" value="@Model.PersonUser?.Password" />
                                        </div>
                                    </div>
                                    <div class="form-group m-form__group row row-password" style="display: @(Model.IsHaveAccount ? "none" : "flex")">
                                        <label class="col-lg-2 col-form-label">Nhập lại mật khẩu</label>
                                        <div class="col-lg-3">
                                            <input type="password" id="peConfirmPassword" name="PersonUser.ConfirmPassword" class="form-control m-input" autocomplete="off" value="@Model.PersonUser?.ConfirmPassword" />
                                        </div>
                                    </div>
                                    <div class="form-group m-form__group row">
                                        <label class="col-lg-2 col-form-label">
                                            Phân quyền
                                        </label>
                                        <div class="col-lg-3">
                                            @if (!string.IsNullOrEmpty(Model.PersonUser.RoleId))
                                            {
                                                <select id="peRoleId" name="PersonUser.RoleId" asp-items="@(new SelectList(ViewBag.RolesList, "Name", "Name", Model.PersonUser.RoleId))" class="form-control m-input m-input--square"></select>
                                            }
                                            else
                                            {
                                                <select id="peRoleId" name="PersonUser.RoleId" asp-items="@(new SelectList(ViewBag.RolesList, "Name", "Name"))" class="form-control m-input m-input--square"></select>
                                            }
                                        </div>
                                    </div>
                                    @if (Model.IsHaveAccount)
                                    {
                                        <div class="form-group m-form__group row">
                                            <label class="col-lg-2 col-form-label">&nbsp;</label>
                                            <div class="col-lg-10">
                                                <button type="button" class="btn btn-danger btn-sm" id="remove-account">Xóa tài khoản</button>
                                            </div>
                                        </div>
                                    }
                                </div>
                            </div>
                        }
                    </div>
                    <div class="m-portlet__foot m-portlet__foot--fit">
                        <div class="m-form__actions m-form__actions">
                            <div class="row">
                                <div class="col-lg-2"></div>
                                <div class="col-lg-6">
                                    <input type="submit" value="Submit" class="btn btn-primary" />
                                    <a asp-action="Index" asp-route-type="@Model.PersonType">Back to List</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="editPCWModal" tabindex="-1" role="dialog" aria-labelledby="editPCWModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Sửa thông tin công việc</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true"></span></button>
            </div>
            <form asp-action="AddPersonWorking" class="m-form m-form--label-align-right" data-ajax="true" data-ajax-method="POST" data-ajax-success="onSuccessEditPCW" data-ajax-failure="onFailureEditPCW">
                <div asp-validation-summary="ModelOnly" class="text-danger"></div>
                <input type="hidden" id="epcwIndex" name="Index" />
                <input type="hidden" id="epcwId" name="Id" />
                <input type="hidden" id="epcwPersonId" name="PersonId" />
                <div class="modal-body">
                    <div class="form-group m-form__group row">
                        <div class="col-lg-6">
                            <div class="form-group m-form__group row">
                                <label class="col-lg-4 col-form-label">
                                    Trạng thái
                                </label>
                                <div class="col-lg-8">
                                    <label class="m-checkbox m-checkbox--focus">
                                        <input type="checkbox" name="IsWorking" id="epcwIsWorking" value="true" />
                                        Đang làm
                                        <span></span>
                                    </label>
                                </div>
                            </div>
                            <div class="form-group m-form__group row">
                                <label class="col-lg-4 col-form-label">
                                    Chức vụ
                                </label>
                                <div class="col-lg-8">
                                    <input id="epcwPosition" name="Position" class="form-control m-input" autocomplete="off" />
                                </div>
                            </div>
                            <div class="form-group m-form__group row">
                                <label class="col-lg-4 col-form-label">
                                    Phòng ban
                                </label>
                                <div class="col-lg-8">
                                    <input id="epcwDepartment" name="Department" class="form-control m-input" autocomplete="off" />
                                </div>
                            </div>
                            <div class="form-group m-form__group row">
                                <label class="col-lg-4 col-form-label">
                                    Công ty
                                </label>
                                <div class="col-lg-8">
                                    <input id="epcwCompany" name="Company" class="form-control m-input" autocomplete="off" />
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-6">
                            <div class="form-group m-form__group row">
                                <label class="col-lg-6 col-form-label">
                                    Ngày bắt đầu nhận chức vụ
                                </label>
                                <div class="col-lg-6">
                                    <input id="epcwStartDate" name="StartDate" class="form-control m-input datepicker" autocomplete="off" />
                                </div>
                            </div>
                            <div class="form-group m-form__group row">
                                <label class="col-lg-6 col-form-label">
                                    Ngày kết thúc chức vụ
                                </label>
                                <div class="col-lg-6">
                                    <input id="epcwEndDate" name="EndDate" class="form-control m-input datepicker" autocomplete="off" />
                                </div>
                            </div>
                            <div class="form-group m-form__group row">
                                <div class="col-lg-6">&nbsp;</div>
                                <div class="col-lg-6">
                                    <label class="m-checkbox m-checkbox--focus">
                                        <input type="checkbox" id="epcwIsMainPosition" name="IsMainPosition" value="true" />
                                        Chúc vụ chính
                                        <span></span>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-info">Lưu</button>
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Đóng</button>
                </div>
            </form>
        </div>
    </div>
</div>

<div class="modal fade" id="editPEWModal" tabindex="-1" role="dialog" aria-labelledby="editPEWModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Sửa thông tin công việc</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true"></span></button>
            </div>
            <form asp-action="AddEmployeeWorking" class="m-form m-form--label-align-right" data-ajax="true" data-ajax-method="POST" data-ajax-success="onSuccessEditPEW" data-ajax-failure="onFailureEditPEW">
                <div asp-validation-summary="ModelOnly" class="text-danger"></div>
                <input type="hidden" id="epewIndex" name="Index" />
                <input type="hidden" id="epewId" name="Id" />
                <input type="hidden" id="epewPersonId" name="PersonId" />
                <div class="modal-body">
                    <div class="form-group m-form__group row">
                        <div class="col-lg-6">
                            <div class="form-group m-form__group row">
                                <label class="col-lg-5 col-form-label">
                                    Trạng thái
                                </label>
                                <div class="col-lg-7">
                                    <label class="m-checkbox m-checkbox--focus">
                                        <input type="checkbox" id="epewIsWorking" name="IsWorking" value="true" />
                                        Đang làm
                                        <span></span>
                                    </label>
                                </div>
                            </div>
                            <div class="form-group m-form__group row">
                                <label class="col-lg-5 col-form-label">
                                    Ngày bắt đầu thử việc
                                </label>
                                <div class="col-lg-7">
                                    <input id="epewTrialWorkDate" name="TrialWorkBeginDate" class="form-control m-input datepicker" autocomplete="off" />
                                </div>
                            </div>
                            <div class="form-group m-form__group row">
                                <label class="col-lg-5 col-form-label">
                                    Ngày được nhận chính thức
                                </label>
                                <div class="col-lg-7">
                                    <input id="epewWorkDate" name="WorkBeginDate" class="form-control m-input datepicker" autocomplete="off" />
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-6">
                            <div class="form-group m-form__group row">
                                <label class="col-lg-4 col-form-label">
                                    Chức vụ
                                </label>
                                <div class="col-lg-8">
                                    <select id="epewPosition" name="DepartmentPositionId" asp-items="@(new SelectList(ViewBag.DepartmentPositions, "Id", "Name"))" class="form-control m-input m-input--square"></select>
                                </div>
                            </div>
                            <div class="form-group m-form__group row">
                                <label class="col-lg-4 col-form-label">
                                    Phòng ban
                                </label>
                                <div class="col-lg-8">
                                    <select id="epewDepartment" name="DepartmentId" asp-items="@(new SelectList(ViewBag.Departments, "Id", "Name"))" class="form-control m-input m-input--square"></select>
                                </div>
                            </div>
                            <div class="form-group m-form__group row">
                                <label class="col-lg-4 col-form-label">
                                    Ngày bắt đầu nhận chức vụ
                                </label>
                                <div class="col-lg-8">
                                    <input id="epewStartDate" name="PositionBeginDate" class="form-control m-input datepicker" autocomplete="off" />
                                </div>
                            </div>
                            <div class="form-group m-form__group row">
                                <label class="col-lg-4 col-form-label">
                                    Ngày kết thúc chức vụ
                                </label>
                                <div class="col-lg-8">
                                    <input id="epewEndDate" name="PositionEndDate" class="form-control m-input datepicker" autocomplete="off" />
                                </div>
                            </div>
                            <div class="form-group m-form__group row">
                                <div class="col-lg-4">&nbsp;</div>
                                <div class="col-lg-8">
                                    <label class="m-checkbox m-checkbox--focus">
                                        <input type="checkbox" id="epewIsMainPosition" name="IsMainPosition" value="true" />
                                        Chúc vụ chính
                                        <span></span>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-info">Lưu</button>
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Đóng</button>
                </div>
            </form>
        </div>
    </div>
</div>

<div class="modal fade" id="addPCCModal" tabindex="-1" role="dialog" aria-labelledby="addPCCModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Thêm nhân viên chăm sóc</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">×</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="row mb-4">
                    <div class="col-md-3">
                        <input class="form-control m-input" id="srchPersonName" placeholder="Tên" />
                    </div>
                    <div class="col-md-3">
                        <input class="form-control m-input" id="srchPersonPhone" placeholder="Điện thoại" />
                    </div>
                    <div class="col-md-3">
                        <button type="button" class="btn btn-info btn-sm btnSrchPerson" data-persontype="@PersonType.Employee">Tìm nhân viên</button>
                    </div>
                </div>
                <div class="row">
                    <div class="col-lg-12">
                        <table class="table table-striped table-bordered table-hover" id="srchemployee-table">
                            <thead>
                                <tr class="text-center">
                                    <th></th>
                                    <th>Họ tên</th>
                                    <th>Chức vụ</th>
                                    <th>Số điện thoại</th>
                                    <th>Email</th>
                                </tr>
                            </thead>
                            <tbody class="srchemployee-container"></tbody>
                        </table>
                    </div>
                </div>
                <input type="hidden" id="pccIndex" />
                <div class="form-group m-form__group row">
                    <label class="col-lg-4 col-form-label">
                        Ngày bắt đầu tiếp nhận
                    </label>
                    <div class="col-lg-4">
                        <input id="pccStartDate" class="form-control m-input datepicker" autocomplete="off" />
                    </div>
                </div>
                <div class="form-group m-form__group row">
                    <label class="col-lg-4 col-form-label">
                        Ngày dừng tiếp nhận
                    </label>
                    <div class="col-lg-4">
                        <input id="pccEndDate" class="form-control m-input datepicker" autocomplete="off" />
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <input class="btn btn-info btn-sm" id="btnAddPCC" value="Lưu" />
                <input class="btn btn-info btn-sm" data-dismiss="modal" value="Đóng" />
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="editPCCModal" tabindex="-1" role="dialog" aria-labelledby="editPCCModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Sửa nhân viên chăm sóc</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true"></span></button>
            </div>
            <form asp-action="AddPersonCustomerCare" class="m-form m-form--label-align-right" data-ajax="true" data-ajax-method="POST" data-ajax-success="onSuccessEditPCC" data-ajax-failure="onFailureEditPCC">
                <div asp-validation-summary="ModelOnly" class="text-danger"></div>
                <input type="hidden" id="epccIndex" name="Index" />
                <input type="hidden" id="epccId" name="Id" />
                <input type="hidden" id="epccPersonId" name="PersonId" />
                <input type="hidden" id="epccEmployeeId" name="EmployeeId" />
                <div class="modal-body">
                    <div class="form-group m-form__group row">
                        <label class="col-lg-5 col-form-label">
                            Nhân viên chăm sóc
                        </label>
                        <div class="col-lg-7">
                            <input id="epccEmployeeName" class="form-control m-input" readonly />
                        </div>
                    </div>
                    <div class="form-group m-form__group row">
                        <label class="col-lg-5 col-form-label">
                            Ngày bắt đầu tiếp nhận
                        </label>
                        <div class="col-lg-7">
                            <input id="epccStartDate" name="StartDate" class="form-control m-input datepicker" autocomplete="off" />
                        </div>
                    </div>
                    <div class="form-group m-form__group row">
                        <label class="col-lg-5 col-form-label">
                            Ngày dừng tiếp nhận
                        </label>
                        <div class="col-lg-7">
                            <input id="epccEndDate" name="EndDate" class="form-control m-input datepicker" autocomplete="off" />
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-info">Lưu</button>
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Đóng</button>
                </div>
            </form>
        </div>
    </div>
</div>

<div class="modal fade" id="chooseCustomerSourceModal" tabindex="-1" role="dialog" aria-labelledby="chooseCustomerSourceModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Chọn nguồn khách hàng</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">×</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="row mb-4">
                    <div class="col-md-3">
                        <input class="form-control m-input" id="srchPersonName" placeholder="Tên" />
                    </div>
                    <div class="col-md-3">
                        <input class="form-control m-input" id="srchPersonPhone" placeholder="Điện thoại" />
                    </div>
                    <div class="col-md-3">
                        <button type="button" class="btn btn-info btn-sm btnSrchPerson" data-persontype="">Tìm kiếm</button>
                    </div>
                </div>
                <div class="row">
                    <div class="col-lg-12">
                        <table class="table table-striped table-bordered table-hover" id="srchemployee-table">
                            <thead>
                                <tr class="text-center">
                                    <th></th>
                                    <th>Họ tên</th>
                                    <th>Chức vụ</th>
                                    <th>Số điện thoại</th>
                                    <th>Email</th>
                                </tr>
                            </thead>
                            <tbody class="srchemployee-container"></tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <input class="btn btn-info btn-sm" id="btnSaveCustomerSource" value="Lưu" />
                <input class="btn btn-info btn-sm" data-dismiss="modal" value="Đóng" />
            </div>
        </div>
    </div>
</div>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
    <script src="~/js/person_agency.js?t=@(DateTimeOffset.UtcNow.ToUnixTimeSeconds())"></script>
    <script>
        $(document).ready(function () {
            if (@((int)Model.PersonType) == 0)
                SetActiveMenu('employeeMenu');
            else if (@((int)Model.PersonType) == 1)
                SetActiveMenu('customerMenu');
            else if (@((int)Model.PersonType) == 2)
                SetActiveMenu('resprentativeMenu');
        });
    </script>
}
